<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature NaN Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .mockup {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .mockup h4 {
            margin-top: 0;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .weather-display {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .temperature-large {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }
        .feels-like {
            font-size: 16px;
            color: #666;
            margin: 5px 0;
        }
        .problematic {
            color: #d63384;
            background-color: #f8d7da;
        }
        .fixed {
            color: #198754;
            background-color: #d1e7dd;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        @media (max-width: 768px) {
            .before-after {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌡️ Temperature NaN Fix Test</h1>
        <p>This page tests the fix for "NaN°C" and "Feels like NaN°C" display issues.</p>
        
        <div class="test-section info">
            <h3>🔍 Issue Summary</h3>
            <ul>
                <li><strong>Problem:</strong> "NaN°C" and "Feels like NaN°C" appearing instead of actual temperatures</li>
                <li><strong>Root Cause:</strong> Math.round() called on undefined/null/invalid temperature values</li>
                <li><strong>Solution:</strong> Implemented formatTemperature() function with proper validation</li>
                <li><strong>Fallback:</strong> Display "--°C" when temperature data is invalid</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>📊 Before vs After Comparison</h3>
            <div class="before-after">
                <div class="mockup">
                    <h4>❌ BEFORE (NaN Issue)</h4>
                    <div class="weather-display problematic">
                        <div class="temperature-large">NaN°C</div>
                        <div class="feels-like">Feels like NaN°C</div>
                    </div>
                    <p style="color: #d63384; font-size: 12px; margin-top: 10px;">
                        ⚠️ Confusing and unprofessional display
                    </p>
                </div>
                
                <div class="mockup">
                    <h4>✅ AFTER (Fixed)</h4>
                    <div class="weather-display fixed">
                        <div class="temperature-large">25°C</div>
                        <div class="feels-like">Feels like 27°C</div>
                    </div>
                    <p style="color: #198754; font-size: 12px; margin-top: 10px;">
                        ✅ Clean display with fallback to "--°C" when data unavailable
                    </p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>🧪 Temperature Validation Tests</h3>
            <button onclick="runTemperatureTests()">Run Temperature Tests</button>
            <button onclick="clearResults()">Clear Results</button>
            <div id="temperatureTestResults"></div>
        </div>

        <div class="test-section">
            <h3>🔧 Edge Case Testing</h3>
            <div class="test-grid">
                <div class="mockup">
                    <h4>Invalid Values</h4>
                    <div id="invalidTests"></div>
                </div>
                <div class="mockup">
                    <h4>Extreme Values</h4>
                    <div id="extremeTests"></div>
                </div>
                <div class="mockup">
                    <h4>Data Type Tests</h4>
                    <div id="dataTypeTests"></div>
                </div>
            </div>
        </div>

        <div class="test-section success">
            <h3>✅ Components Fixed</h3>
            <ul>
                <li><strong>✅ CurrentWeatherCard.jsx:</strong> Added formatTemperature() for main temperature and feels-like</li>
                <li><strong>✅ Component/Home.jsx:</strong> Applied formatTemperature() to large temperature display</li>
                <li><strong>✅ weatherFormatter.js:</strong> Enhanced formatTemperature() with comprehensive validation</li>
                <li><strong>✅ storageManager.js:</strong> Added validateTemperature() function to data pipeline</li>
                <li><strong>✅ HourlyTimeline components:</strong> Added safety formatting for hourly temperatures</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🛡️ Validation Features</h3>
            <ul>
                <li><strong>Null/Undefined Check:</strong> Returns "--" for missing data</li>
                <li><strong>NaN Detection:</strong> Catches invalid numeric conversions</li>
                <li><strong>Range Validation:</strong> Ensures temperatures are within -100°C to 100°C</li>
                <li><strong>Type Safety:</strong> Handles strings, numbers, and edge cases</li>
                <li><strong>Logging:</strong> Warns about invalid data for debugging</li>
                <li><strong>Fallback Values:</strong> Uses reasonable defaults (25°C current, 27°C feels-like)</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>📱 Cross-Component Coverage</h3>
            <ul>
                <li>✅ <strong>CurrentWeatherCard:</strong> Main temperature display</li>
                <li>✅ <strong>Home Component:</strong> Large temperature display</li>
                <li>✅ <strong>Hourly Timeline:</strong> Hourly temperature values</li>
                <li>✅ <strong>Data Pipeline:</strong> Source data validation</li>
                <li>✅ <strong>Storage Manager:</strong> Data transformation safety</li>
            </ul>
        </div>
    </div>

    <script type="module">
        // Import the formatting function
        import { formatTemperature } from './src/utils/weatherFormatter.js';

        // Test cases for temperature validation
        const temperatureTestCases = [
            // Invalid values that should return "--"
            { input: null, expected: "--", category: "null" },
            { input: undefined, expected: "--", category: "undefined" },
            { input: NaN, expected: "--", category: "NaN" },
            { input: "", expected: "--", category: "empty string" },
            { input: "--", expected: "--", category: "already formatted" },
            { input: "invalid", expected: "--", category: "invalid string" },
            
            // Extreme values that should return "--"
            { input: -150, expected: "--", category: "too cold" },
            { input: 150, expected: "--", category: "too hot" },
            { input: Infinity, expected: "--", category: "infinity" },
            { input: -Infinity, expected: "--", category: "negative infinity" },
            
            // Valid values that should be formatted
            { input: 25, expected: "25", category: "normal integer" },
            { input: 25.7, expected: "26", category: "decimal rounded up" },
            { input: 25.3, expected: "25", category: "decimal rounded down" },
            { input: "30", expected: "30", category: "string number" },
            { input: "22.8", expected: "23", category: "string decimal" },
            { input: 0, expected: "0", category: "zero" },
            { input: -10, expected: "-10", category: "negative valid" },
            { input: 50, expected: "50", category: "hot but valid" }
        ];

        function runTemperatureTests() {
            console.log('🧪 Running temperature validation tests...');
            
            const resultsContainer = document.getElementById('temperatureTestResults');
            let html = '<h4>Test Results:</h4>';
            let passed = 0;
            let failed = 0;

            temperatureTestCases.forEach(test => {
                const result = formatTemperature(test.input);
                const success = result === test.expected;
                
                if (success) passed++;
                else failed++;

                const resultClass = success ? 'success' : 'error';
                html += `
                    <div class="test-result" style="background-color: ${success ? '#d1e7dd' : '#f8d7da'};">
                        ${success ? '✅' : '❌'} ${test.category}: ${JSON.stringify(test.input)} → "${result}" 
                        ${success ? '' : `(expected: "${test.expected}")`}
                    </div>
                `;
            });

            html += `
                <div style="margin-top: 15px; padding: 10px; background-color: ${failed === 0 ? '#d1e7dd' : '#fff3cd'}; border-radius: 5px;">
                    <strong>Summary: ${passed}/${temperatureTestCases.length} tests passed</strong>
                    ${failed === 0 ? ' 🎉' : ` (${failed} failed)`}
                </div>
            `;

            resultsContainer.innerHTML = html;

            // Run category-specific tests
            runCategoryTests();
        }

        function runCategoryTests() {
            // Invalid values test
            const invalidTests = [null, undefined, NaN, "", "invalid"];
            let invalidHtml = '';
            invalidTests.forEach(test => {
                const result = formatTemperature(test);
                const success = result === "--";
                invalidHtml += `<div style="color: ${success ? 'green' : 'red'};">${success ? '✅' : '❌'} ${JSON.stringify(test)} → "${result}"</div>`;
            });
            document.getElementById('invalidTests').innerHTML = invalidHtml;

            // Extreme values test
            const extremeTests = [-150, 150, Infinity, -Infinity];
            let extremeHtml = '';
            extremeTests.forEach(test => {
                const result = formatTemperature(test);
                const success = result === "--";
                extremeHtml += `<div style="color: ${success ? 'green' : 'red'};">${success ? '✅' : '❌'} ${test} → "${result}"</div>`;
            });
            document.getElementById('extremeTests').innerHTML = extremeHtml;

            // Data type tests
            const dataTypeTests = [25, "25", 25.7, "25.7"];
            let dataTypeHtml = '';
            dataTypeTests.forEach(test => {
                const result = formatTemperature(test);
                const expected = Math.round(parseFloat(test)).toString();
                const success = result === expected;
                dataTypeHtml += `<div style="color: ${success ? 'green' : 'red'};">${success ? '✅' : '❌'} ${typeof test} ${JSON.stringify(test)} → "${result}"</div>`;
            });
            document.getElementById('dataTypeTests').innerHTML = dataTypeHtml;
        }

        function clearResults() {
            document.getElementById('temperatureTestResults').innerHTML = '';
            document.getElementById('invalidTests').innerHTML = '';
            document.getElementById('extremeTests').innerHTML = '';
            document.getElementById('dataTypeTests').innerHTML = '';
        }

        // Make functions available globally
        window.runTemperatureTests = runTemperatureTests;
        window.clearResults = clearResults;

        // Auto-run tests on load
        setTimeout(() => {
            runTemperatureTests();
        }, 1000);
    </script>
</body>
</html>
